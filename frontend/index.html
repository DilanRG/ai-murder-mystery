<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; connect-src 'self' http://127.0.0.1:*; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;">
    <title>AI Murder Mystery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Inter:wght@300;400;500;600&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Atmospheric background particles -->
    <div id="particles-bg"></div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TITLE SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-title" class="screen active">
        <div class="title-content">
            <div class="title-ornament">‚öú</div>
            <h1 class="title-main">MURDER<br><span class="title-accent">MYSTERY</span></h1>
            <p class="title-subtitle">An AI-Driven Investigation</p>
            <div class="title-divider"></div>
            <button id="btn-new-game" class="btn btn-primary btn-glow">Begin Investigation</button>
            <button id="btn-settings" class="btn btn-ghost">‚öô Settings</button>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="modal-settings" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content glass-panel settings-panel">
            <div class="settings-header">
                <h2 class="modal-title">‚öô Configuration</h2>
                <button id="btn-close-settings" class="btn-icon" title="Close">‚úï</button>
            </div>

            <div class="settings-body">
                <!-- Section 1: Connection -->
                <div class="settings-section">
                    <h3 class="settings-section-title">Connection</h3>
                    <div class="form-group">
                        <label for="input-api-key">OpenRouter API Key</label>
                        <div class="input-row">
                            <input type="password" id="input-api-key" class="input-field input-flex"
                                placeholder="sk-or-v1-...">
                            <button id="btn-reveal-key" class="btn-icon" title="Show/Hide">üëÅ</button>
                        </div>
                        <small>Get a free key at <a href="https://openrouter.ai"
                                target="_blank">openrouter.ai</a></small>
                    </div>
                    <div class="connection-status">
                        <span id="connection-dot" class="status-dot disconnected"></span>
                        <span id="connection-text">Not connected</span>
                        <button id="btn-connect" class="btn btn-sm btn-outline">Connect</button>
                    </div>
                </div>

                <!-- Section 2: Model -->
                <div class="settings-section">
                    <h3 class="settings-section-title">Model</h3>
                    <div class="form-group">
                        <label>OpenRouter Model</label>
                        <div class="model-search-container">
                            <div id="model-selected" class="model-selected-chip hidden">
                                <span id="model-selected-name"></span>
                                <button id="btn-clear-model" class="btn-chip-clear">‚úï</button>
                            </div>
                            <input type="text" id="input-model-search" class="input-field"
                                placeholder="Search models..." autocomplete="off">
                            <div id="model-results" class="model-results hidden"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Model Providers <span class="optional">(optional filter)</span></label>
                        <div class="provider-container">
                            <div id="provider-tags" class="provider-tags"></div>
                            <input type="text" id="input-provider-search" class="input-field input-sm"
                                placeholder="Add provider..." autocomplete="off">
                            <div id="provider-results" class="provider-results hidden"></div>
                        </div>
                    </div>
                </div>

                <!-- Section 3: Generation -->
                <div class="settings-section">
                    <h3 class="settings-section-title">Generation</h3>
                    <div class="form-group">
                        <label for="select-instruct">Instruct Template</label>
                        <select id="select-instruct" class="input-field"></select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="input-context-length">Context Length</label>
                            <input type="number" id="input-context-length" class="input-field" min="512" max="1000000"
                                step="512" value="8192">
                        </div>
                        <div class="form-group">
                            <label for="input-response-length">Response Length</label>
                            <input type="number" id="input-response-length" class="input-field" min="64" max="32768"
                                step="64" value="1024">
                        </div>
                    </div>
                </div>

                <!-- Section 4: Samplers -->
                <div class="settings-section">
                    <h3 class="settings-section-title">Samplers</h3>
                    <div class="form-group">
                        <label for="input-temperature">Temperature <span class="range-value"
                                id="temp-value">0.9</span></label>
                        <input type="range" id="input-temperature" min="0" max="2" step="0.05" value="0.9">
                    </div>
                    <div class="form-group">
                        <label for="input-top-p">Top P <span class="range-value" id="top-p-value">0.95</span></label>
                        <input type="range" id="input-top-p" min="0" max="1" step="0.05" value="0.95">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="input-top-k">Top K <span class="optional">(0=off)</span></label>
                            <input type="number" id="input-top-k" class="input-field" min="0" max="500" value="40">
                        </div>
                        <div class="form-group">
                            <label for="input-min-p">Min P</label>
                            <input type="number" id="input-min-p" class="input-field" min="0" max="1" step="0.01"
                                value="0.05">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="input-rep-penalty">Repetition Penalty <span class="range-value"
                                id="rep-value">1.1</span></label>
                        <input type="range" id="input-rep-penalty" min="1" max="2" step="0.05" value="1.1">
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button id="btn-save-settings" class="btn btn-primary">Save Settings</button>
                <button id="btn-close-settings-2" class="btn btn-ghost">Cancel</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETUP SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-setup" class="screen hidden">
        <div class="setup-content">
            <h2 class="section-title">Choose Your Role</h2>
            <p class="section-desc">Will you uncover the truth... or bury it deeper?</p>

            <div class="role-selection">
                <div class="role-card" data-role="detective" id="role-detective">
                    <div class="role-icon">üîç</div>
                    <h3>Detective</h3>
                    <p>Interrogate suspects, gather evidence, and expose the killer before it's too late.</p>
                </div>
                <div class="role-vs">VS</div>
                <div class="role-card" data-role="killer" id="role-killer">
                    <div class="role-icon">üó°Ô∏è</div>
                    <h3>Killer</h3>
                    <p>Deflect suspicion, manipulate witnesses, and escape justice by any means necessary.</p>
                </div>
            </div>

            <div class="player-setup hidden" id="player-setup">
                <div class="form-group">
                    <label for="input-player-name">Your Character Name</label>
                    <input type="text" id="input-player-name" class="input-field" placeholder="Enter a name..."
                        value="Detective Gray">
                </div>
                <div class="form-group">
                    <label for="input-player-desc">Character Description <span
                            class="optional">(optional)</span></label>
                    <textarea id="input-player-desc" class="input-field textarea" rows="3"
                        placeholder="Describe your character's background and personality..."></textarea>
                </div>
                <button id="btn-start-game" class="btn btn-primary btn-glow btn-lg">
                    <span class="btn-text">Begin the Mystery</span>
                    <span class="btn-loading hidden">Generating Scenario...</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOADING SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-loading" class="screen hidden">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h2 class="loading-title" id="loading-title">Crafting the Mystery</h2>
            <p class="loading-text" id="loading-text">The AI is weaving a web of intrigue and deception...</p>
            <div class="loading-bar">
                <div class="loading-bar-fill" id="loading-bar-fill"></div>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GAME SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-game" class="screen hidden">
        <div class="game-layout">
            <!-- Left Sidebar: Location & Characters -->
            <aside class="game-sidebar sidebar-left">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">üìç Location</h3>
                    <div id="current-location" class="location-display">
                        <h4 id="location-name" class="location-name">‚Äî</h4>
                        <p id="location-desc" class="location-desc"></p>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">üó∫Ô∏è Move To</h3>
                    <div id="location-list" class="location-list"></div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">üë• Characters Here</h3>
                    <div id="characters-here" class="character-list"></div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">üìä Progress</h3>
                    <div id="game-progress" class="progress-display">
                        <div class="progress-item">
                            <span>Turn</span>
                            <span id="turn-counter">0 / 30</span>
                        </div>
                        <div class="progress-item">
                            <span>Clues</span>
                            <span id="clue-counter">0 / ?</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Center: Main Dialogue & Actions -->
            <main class="game-main">
                <div class="game-header">
                    <h2 id="scenario-title" class="scenario-title"></h2>
                    <div class="game-header-actions">
                        <button id="btn-accuse" class="btn btn-danger btn-sm" title="Make your accusation">‚öñ
                            Accuse</button>
                    </div>
                </div>

                <div id="dialogue-panel" class="dialogue-panel">
                    <div id="dialogue-messages" class="dialogue-messages">
                        <!-- Messages will be appended here -->
                    </div>
                </div>

                <div class="action-bar">
                    <div class="action-input-row">
                        <input type="text" id="input-message" class="input-field input-message"
                            placeholder="Say something to the NPC...">
                        <button id="btn-send" class="btn btn-primary btn-send" disabled>Send</button>
                    </div>
                    <div class="action-buttons">
                        <button id="btn-investigate" class="btn btn-outline btn-action"
                            title="Search the current location">üîç Investigate</button>
                        <button id="btn-wait" class="btn btn-outline btn-action" title="Wait and observe">‚è≥
                            Wait</button>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar: Clue Journal -->
            <aside class="game-sidebar sidebar-right">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">üìã Clue Journal</h3>
                    <div id="clue-journal" class="clue-journal">
                        <p class="journal-empty">No clues discovered yet. Start investigating!</p>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">üì∞ Event Log</h3>
                    <div id="event-log" class="event-log">
                        <p class="log-empty">The investigation begins...</p>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ACCUSATION MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="modal-accuse" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content glass-panel">
            <h2 class="modal-title">‚öñ Make Your Accusation</h2>
            <p class="modal-desc">Choose carefully ‚Äî this will end the game.</p>
            <div class="form-group">
                <label for="select-suspect">Who is the killer?</label>
                <select id="select-suspect" class="input-field"></select>
            </div>
            <div class="form-group">
                <label for="input-reasoning">Your reasoning <span class="optional">(optional)</span></label>
                <textarea id="input-reasoning" class="input-field textarea" rows="3"
                    placeholder="Explain your deduction..."></textarea>
            </div>
            <div class="form-actions">
                <button id="btn-confirm-accuse" class="btn btn-danger">Confirm Accusation</button>
                <button id="btn-cancel-accuse" class="btn btn-ghost">Go Back</button>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESULTS SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="screen-results" class="screen hidden">
        <div class="results-content">
            <div id="results-icon" class="results-icon">üèÜ</div>
            <h2 id="results-title" class="results-title">Case Closed</h2>
            <div id="results-narrative" class="results-narrative"></div>
            <div id="results-stats" class="results-stats"></div>
            <button id="btn-play-again" class="btn btn-primary btn-glow">Play Again</button>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>

</html>